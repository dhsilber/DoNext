{"ast":null,"code":"import{DayMilliseconds,HourMilliseconds,NowMarker,UNSET}from'../Constants';import{dayTimestampStartMilliseconds,humanTimeToMillisecondsSinceMidnight}from'../DateUtilities';var eventSorter=function eventSorter(source){var startTime=Date.now()-2*HourMilliseconds;var endTime=Date.now()+48*HourMilliseconds;var routineSchedule=source.routine;var startMidnight=dayTimestampStartMilliseconds(startTime);var midnights=[];for(var midnight=startMidnight;midnight<endTime;midnight+=DayMilliseconds){midnights.push(midnight);}var constructedEvents=midnights.flatMap(function(midnight){var day=new Date(midnight).getDay();var routineEvents=[];routineSchedule.filter(function(routine){return routine.days.length===0||routine.days.includes(day);}).forEach(function(routine){var event={id:routine.id,text:routine.text,start:midnight+humanTimeToMillisecondsSinceMidnight(routine.start),duration:humanTimeToMillisecondsSinceMidnight(routine.duration)};routineEvents.push(event);});return routineEvents;});constructedEvents.push({id:UNSET,text:NowMarker,duration:0,start:Date.now()});var currentEvents=constructedEvents.concat(source.events).sort(function(a,b){if(b.start>a.start){return-1;}else{return 1;}}).filter(function(event){return event.start+event.duration>startTime&&event.start<endTime;});return currentEvents;};export default eventSorter;","map":{"version":3,"names":["DayMilliseconds","HourMilliseconds","NowMarker","UNSET","dayTimestampStartMilliseconds","humanTimeToMillisecondsSinceMidnight","eventSorter","source","startTime","Date","now","endTime","routineSchedule","routine","startMidnight","midnights","midnight","push","constructedEvents","flatMap","day","getDay","routineEvents","filter","days","length","includes","forEach","event","id","text","start","duration","currentEvents","concat","events","sort","a","b"],"sources":["/Users/dhs/do-next/src/event/EventSorter.ts"],"sourcesContent":["import { DayMilliseconds, HourMilliseconds, NowMarker, UNSET } from '../Constants'\nimport { dayTimestampStartMilliseconds, humanTimeToMillisecondsSinceMidnight } from '../DateUtilities'\nimport { EventSet, Event } from '../DoData'\n\nconst eventSorter = (source: EventSet) => {\n    const startTime = Date.now() - 2 * HourMilliseconds\n    const endTime = Date.now() + 48 * HourMilliseconds\n\n    const routineSchedule = source.routine\n\n    const startMidnight = dayTimestampStartMilliseconds(startTime)\n    const midnights: number[] = []\n    for (let midnight = startMidnight; midnight < endTime; midnight += DayMilliseconds) {\n        midnights.push(midnight)\n    }\n\n    const constructedEvents = midnights.flatMap((midnight) => {\n        const day = new Date(midnight).getDay()\n        let routineEvents: Event[] = []\n        routineSchedule\n            .filter(routine => routine.days.length === 0 || routine.days.includes(day))\n            .forEach((routine) => {\n                let event: Event = {\n                    id: routine.id,\n                    text: routine.text,\n                    start: midnight + humanTimeToMillisecondsSinceMidnight( routine.start ),\n                    duration: humanTimeToMillisecondsSinceMidnight( routine.duration)\n                }\n                routineEvents.push(event)\n            })\n        return routineEvents\n    })\n    constructedEvents.push({ id: UNSET, text: NowMarker, duration: 0, start: Date.now() })\n\n    const currentEvents = constructedEvents\n        .concat(source.events)\n        .sort((a, b) => { if (b.start > a.start) { return -1 } else { return 1 } })\n        .filter(event => (event.start + event.duration) > startTime && event.start < endTime)\n\n    return currentEvents\n}\n\nexport default eventSorter\n"],"mappings":"AAAA,OAASA,eAAT,CAA0BC,gBAA1B,CAA4CC,SAA5C,CAAuDC,KAAvD,KAAoE,cAApE,CACA,OAASC,6BAAT,CAAwCC,oCAAxC,KAAoF,kBAApF,CAGA,GAAMC,YAAW,CAAG,QAAdA,YAAc,CAACC,MAAD,CAAsB,CACtC,GAAMC,UAAS,CAAGC,IAAI,CAACC,GAAL,GAAa,EAAIT,gBAAnC,CACA,GAAMU,QAAO,CAAGF,IAAI,CAACC,GAAL,GAAa,GAAKT,gBAAlC,CAEA,GAAMW,gBAAe,CAAGL,MAAM,CAACM,OAA/B,CAEA,GAAMC,cAAa,CAAGV,6BAA6B,CAACI,SAAD,CAAnD,CACA,GAAMO,UAAmB,CAAG,EAA5B,CACA,IAAK,GAAIC,SAAQ,CAAGF,aAApB,CAAmCE,QAAQ,CAAGL,OAA9C,CAAuDK,QAAQ,EAAIhB,eAAnE,CAAoF,CAChFe,SAAS,CAACE,IAAV,CAAeD,QAAf,EACH,CAED,GAAME,kBAAiB,CAAGH,SAAS,CAACI,OAAV,CAAkB,SAACH,QAAD,CAAc,CACtD,GAAMI,IAAG,CAAG,GAAIX,KAAJ,CAASO,QAAT,EAAmBK,MAAnB,EAAZ,CACA,GAAIC,cAAsB,CAAG,EAA7B,CACAV,eAAe,CACVW,MADL,CACY,SAAAV,OAAO,QAAIA,QAAO,CAACW,IAAR,CAAaC,MAAb,GAAwB,CAAxB,EAA6BZ,OAAO,CAACW,IAAR,CAAaE,QAAb,CAAsBN,GAAtB,CAAjC,EADnB,EAEKO,OAFL,CAEa,SAACd,OAAD,CAAa,CAClB,GAAIe,MAAY,CAAG,CACfC,EAAE,CAAEhB,OAAO,CAACgB,EADG,CAEfC,IAAI,CAAEjB,OAAO,CAACiB,IAFC,CAGfC,KAAK,CAAEf,QAAQ,CAAGX,oCAAoC,CAAEQ,OAAO,CAACkB,KAAV,CAHvC,CAIfC,QAAQ,CAAE3B,oCAAoC,CAAEQ,OAAO,CAACmB,QAAV,CAJ/B,CAAnB,CAMAV,aAAa,CAACL,IAAd,CAAmBW,KAAnB,EACH,CAVL,EAWA,MAAON,cAAP,CACH,CAfyB,CAA1B,CAgBAJ,iBAAiB,CAACD,IAAlB,CAAuB,CAAEY,EAAE,CAAE1B,KAAN,CAAa2B,IAAI,CAAE5B,SAAnB,CAA8B8B,QAAQ,CAAE,CAAxC,CAA2CD,KAAK,CAAEtB,IAAI,CAACC,GAAL,EAAlD,CAAvB,EAEA,GAAMuB,cAAa,CAAGf,iBAAiB,CAClCgB,MADiB,CACV3B,MAAM,CAAC4B,MADG,EAEjBC,IAFiB,CAEZ,SAACC,CAAD,CAAIC,CAAJ,CAAU,CAAE,GAAIA,CAAC,CAACP,KAAF,CAAUM,CAAC,CAACN,KAAhB,CAAuB,CAAE,MAAO,CAAC,CAAR,CAAW,CAApC,IAA0C,CAAE,MAAO,EAAP,CAAU,CAAE,CAFxD,EAGjBR,MAHiB,CAGV,SAAAK,KAAK,QAAKA,MAAK,CAACG,KAAN,CAAcH,KAAK,CAACI,QAArB,CAAiCxB,SAAjC,EAA8CoB,KAAK,CAACG,KAAN,CAAcpB,OAAhE,EAHK,CAAtB,CAKA,MAAOsB,cAAP,CACH,CApCD,CAsCA,cAAe3B,YAAf"},"metadata":{},"sourceType":"module"}